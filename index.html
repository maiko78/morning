<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="manifest" href="manifest.json">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãŠã¯ã‚ˆã†è¨˜éŒ²</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;500&family=Shippori+Mincho:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0d1117;
    --bg2: #161b22;
    --surface: #1a2030;
    --border: #2a3444;
    --dawn1: #ff7b4f;
    --dawn2: #ffb347;
    --dawn3: #ffd580;
    --sky: #4a90d9;
    --text: #e8e0d4;
    --muted: #8a8a9a;
    --danger: #e05555;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Serif JP', serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 24px 16px 48px;
    position: relative;
    overflow-x: hidden;
  }

  /* èƒŒæ™¯ã®å¤œæ˜ã‘ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
  body::before {
    content: '';
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 40vh;
    background: radial-gradient(ellipse 80% 60% at 50% 110%, rgba(255,123,79,0.12), transparent),
                radial-gradient(ellipse 60% 40% at 20% 120%, rgba(74,144,217,0.08), transparent);
    pointer-events: none;
    z-index: 0;
  }

  .stars {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 60vh;
    pointer-events: none;
    z-index: 0;
  }

  .star {
    position: absolute;
    background: white;
    border-radius: 50%;
    animation: twinkle var(--d, 3s) ease-in-out infinite;
    opacity: var(--o, 0.4);
  }

  @keyframes twinkle {
    0%, 100% { opacity: var(--o, 0.4); transform: scale(1); }
    50% { opacity: calc(var(--o, 0.4) * 0.3); transform: scale(0.7); }
  }

  .container {
    width: 100%;
    max-width: 440px;
    position: relative;
    z-index: 1;
  }

  header {
    text-align: center;
    margin-bottom: 40px;
    padding-top: 20px;
  }

  .app-title {
    font-family: 'Shippori Mincho', serif;
    font-size: 2rem;
    font-weight: 500;
    letter-spacing: 0.3em;
    background: linear-gradient(135deg, var(--dawn3), var(--dawn1));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 6px;
  }

  .app-subtitle {
    color: var(--muted);
    font-size: 0.75rem;
    letter-spacing: 0.2em;
  }

  /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ */
  .main-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 36px 28px;
    margin-bottom: 32px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }

  .main-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--dawn1), var(--dawn3), transparent);
  }

  .status-label {
    font-size: 0.7rem;
    letter-spacing: 0.25em;
    color: var(--muted);
    margin-bottom: 20px;
    text-transform: uppercase;
  }

  /* ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º */
  .timer-display {
    font-family: 'Shippori Mincho', serif;
    font-size: 4rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    margin: 16px 0 28px;
    color: var(--dawn3);
    text-shadow: 0 0 40px rgba(255,213,128,0.3);
    transition: color 0.5s;
    line-height: 1;
  }

  .timer-display.idle { color: var(--muted); text-shadow: none; font-size: 2.5rem; }
  .timer-display.running { animation: pulse-glow 2s ease-in-out infinite; }
  .timer-display.done { color: var(--sky); text-shadow: 0 0 40px rgba(74,144,217,0.3); }

  @keyframes pulse-glow {
    0%, 100% { text-shadow: 0 0 30px rgba(255,213,128,0.3); }
    50% { text-shadow: 0 0 60px rgba(255,213,128,0.6); }
  }

  /* ãƒœã‚¿ãƒ³ */
  .btn-wake {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    border: 2px solid var(--dawn1);
    background: radial-gradient(circle at 40% 40%, rgba(255,180,100,0.15), rgba(255,123,79,0.05));
    color: var(--dawn3);
    font-family: 'Shippori Mincho', serif;
    font-size: 1rem;
    font-weight: 500;
    letter-spacing: 0.2em;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin: 0 auto 8px;
    position: relative;
    box-shadow: 0 0 40px rgba(255,123,79,0.15), inset 0 0 20px rgba(255,123,79,0.05);
  }

  .btn-wake::before {
    content: '';
    position: absolute;
    inset: -6px;
    border-radius: 50%;
    border: 1px solid rgba(255,123,79,0.2);
    animation: ring-expand 3s ease-in-out infinite;
  }

  @keyframes ring-expand {
    0%, 100% { transform: scale(1); opacity: 0.5; }
    50% { transform: scale(1.06); opacity: 0.1; }
  }

  .btn-wake:hover {
    border-color: var(--dawn3);
    background: radial-gradient(circle at 40% 40%, rgba(255,213,128,0.2), rgba(255,123,79,0.08));
    box-shadow: 0 0 60px rgba(255,123,79,0.25), inset 0 0 30px rgba(255,123,79,0.08);
    transform: scale(1.03);
  }

  .btn-wake-icon { font-size: 2rem; }

  .btn-out {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    border: 2px solid var(--sky);
    background: radial-gradient(circle at 40% 40%, rgba(74,144,217,0.15), rgba(74,144,217,0.03));
    color: #7ab8f5;
    font-family: 'Shippori Mincho', serif;
    font-size: 1rem;
    font-weight: 500;
    letter-spacing: 0.2em;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin: 0 auto 8px;
    box-shadow: 0 0 40px rgba(74,144,217,0.15);
    animation: appear 0.5s ease;
  }

  @keyframes appear {
    from { opacity: 0; transform: scale(0.85); }
    to { opacity: 1; transform: scale(1); }
  }

  .btn-out:hover {
    border-color: #7ab8f5;
    box-shadow: 0 0 60px rgba(74,144,217,0.3);
    transform: scale(1.03);
  }

  .btn-out-icon { font-size: 1.8rem; }

  /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
  .btn-reset {
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 8px 20px;
    border-radius: 20px;
    font-family: 'Noto Serif JP', serif;
    font-size: 0.75rem;
    cursor: pointer;
    letter-spacing: 0.1em;
    transition: all 0.2s;
    margin-top: 12px;
  }

  .btn-reset:hover { border-color: var(--muted); color: var(--text); }

  /* è¨˜éŒ²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
  .records-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
  }

  .records-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
  }

  .records-title {
    font-family: 'Shippori Mincho', serif;
    font-size: 0.85rem;
    letter-spacing: 0.2em;
    color: var(--dawn3);
  }

  .btn-copy-all {
    background: none;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 5px 14px;
    border-radius: 12px;
    font-family: 'Noto Serif JP', serif;
    font-size: 0.7rem;
    cursor: pointer;
    letter-spacing: 0.1em;
    transition: all 0.2s;
  }

  .btn-copy-all:hover { border-color: var(--dawn3); color: var(--dawn3); }

  .records-empty {
    padding: 36px;
    text-align: center;
    color: var(--muted);
    font-size: 0.8rem;
    letter-spacing: 0.15em;
  }

  .record-item {
    padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
    transition: background 0.2s;
    animation: slide-in 0.4s ease;
  }

  @keyframes slide-in {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .record-item:last-child { border-bottom: none; }
  .record-item:hover { background: rgba(255,255,255,0.02); }

  .record-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--dawn1), var(--sky));
    flex-shrink: 0;
  }

  .record-info { flex: 1; min-width: 0; }

  .record-date {
    font-size: 0.72rem;
    color: var(--muted);
    letter-spacing: 0.1em;
    margin-bottom: 2px;
  }

  .record-time {
    font-family: 'Shippori Mincho', serif;
    font-size: 0.95rem;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .record-duration {
    font-family: 'Shippori Mincho', serif;
    font-size: 1.1rem;
    color: var(--sky);
    white-space: nowrap;
    margin-right: 8px;
  }

  .btn-del {
    background: none;
    border: 1px solid transparent;
    color: var(--muted);
    font-size: 0.8rem;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 6px;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .btn-del:hover { border-color: var(--danger); color: var(--danger); }

  /* ãƒˆãƒ¼ã‚¹ãƒˆ */
  .toast {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--bg2);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 10px 24px;
    border-radius: 30px;
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    opacity: 0;
    transition: all 0.3s;
    pointer-events: none;
    z-index: 100;
    white-space: nowrap;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
</style>
</head>
<body>

<div class="stars" id="stars"></div>

<div class="container">
  <header>
    <div class="app-title">ãŠã¯ã‚ˆã†</div>
    <div class="app-subtitle">èµ·åºŠè¨˜éŒ²</div>
  </header>

  <div class="main-card">
    <div class="status-label" id="statusLabel">ç›®è¦šã‚ãŸã‚‰æŠ¼ã—ã¦ãã ã•ã„</div>
    <div class="timer-display idle" id="timerDisplay">âˆ’ âˆ’ : âˆ’ âˆ’</div>
    <div id="btnArea">
      <button class="btn-wake" id="btnWake" onclick="handleWake()">
        <span class="btn-wake-icon">ğŸŒ™</span>
        <span>ç›®è¦šã‚ãŸ</span>
      </button>
    </div>
  </div>

  <div class="records-section">
    <div class="records-header">
      <span class="records-title">èµ·åºŠè¨˜éŒ²</span>
      <button class="btn-copy-all" onclick="copyAll()">ğŸ“‹ å…¨ã¦ã‚³ãƒ”ãƒ¼</button>
    </div>
    <div id="recordsList">
      <div class="records-empty" id="emptyMsg">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  // æ˜Ÿã‚’ç”Ÿæˆ
  const starsEl = document.getElementById('stars');
  for (let i = 0; i < 60; i++) {
    const s = document.createElement('div');
    s.className = 'star';
    const size = Math.random() * 2 + 0.5;
    s.style.cssText = `width:${size}px;height:${size}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--o:${Math.random()*0.5+0.1};--d:${Math.random()*4+2}s;animation-delay:${Math.random()*4}s`;
    starsEl.appendChild(s);
  }

  // çŠ¶æ…‹
  let state = 'idle'; // idle | running | done
  let startTime = null;
  let timerInterval = null;
  let records = JSON.parse(localStorage.getItem('ohayo_records') || '[]');

  const timerDisplay = document.getElementById('timerDisplay');
  const statusLabel = document.getElementById('statusLabel');
  const btnArea = document.getElementById('btnArea');

  function formatDuration(ms) {
    const s = Math.floor(ms / 1000);
    const m = Math.floor(s / 60);
    const sec = s % 60;
    return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
  }

  function formatDateTime(date) {
    const y = date.getFullYear();
    const mo = date.getMonth() + 1;
    const d = date.getDate();
    const h = String(date.getHours()).padStart(2,'0');
    const mi = String(date.getMinutes()).padStart(2,'0');
    return { date: `${y}å¹´${mo}æœˆ${d}æ—¥`, time: `${h}:${mi}` };
  }

  function handleWake() {
    if (state !== 'idle') return;
    state = 'running';
    startTime = new Date();
    statusLabel.textContent = 'å¸ƒå›£ã‚’å‡ºãŸã‚‰æŠ¼ã—ã¦ãã ã•ã„';
    timerDisplay.className = 'timer-display running';
    timerDisplay.textContent = '00:00';

    btnArea.innerHTML = `<button class="btn-out" id="btnOut" onclick="handleOut()">
      <span class="btn-out-icon">â˜€ï¸</span>
      <span>å¸ƒå›£ã‚’å‡ºãŸ</span>
    </button>
    <br>
    <button class="btn-reset" onclick="resetState()">ã‚„ã‚Šç›´ã™</button>`;

    timerInterval = setInterval(() => {
      timerDisplay.textContent = formatDuration(Date.now() - startTime);
    }, 1000);
  }

  function handleOut() {
    if (state !== 'running') return;
    clearInterval(timerInterval);
    state = 'done';

    const endTime = new Date();
    const duration = endTime - startTime;
    const durationStr = formatDuration(duration);
    const dt = formatDateTime(startTime);

    const record = {
      id: Date.now(),
      date: dt.date,
      startTime: dt.time,
      durationMs: duration,
      durationStr: durationStr
    };

    records.unshift(record);
    localStorage.setItem('ohayo_records', JSON.stringify(records));

    statusLabel.textContent = 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼';
    timerDisplay.className = 'timer-display done';
    timerDisplay.textContent = durationStr;

    btnArea.innerHTML = `<button class="btn-reset" onclick="resetState()" style="margin-top:0">æ–°ã—ã„è¨˜éŒ²ã‚’å§‹ã‚ã‚‹</button>`;

    renderRecords();
    showToast(`${durationStr} ã§èµ·ãä¸ŠãŒã‚Šã¾ã—ãŸ â˜€ï¸`);
  }

  function resetState() {
    clearInterval(timerInterval);
    state = 'idle';
    startTime = null;
    statusLabel.textContent = 'ç›®è¦šã‚ãŸã‚‰æŠ¼ã—ã¦ãã ã•ã„';
    timerDisplay.className = 'timer-display idle';
    timerDisplay.textContent = 'âˆ’ âˆ’ : âˆ’ âˆ’';
    btnArea.innerHTML = `<button class="btn-wake" id="btnWake" onclick="handleWake()">
      <span class="btn-wake-icon">ğŸŒ™</span>
      <span>ç›®è¦šã‚ãŸ</span>
    </button>`;
  }

  function deleteRecord(id) {
    records = records.filter(r => r.id !== id);
    localStorage.setItem('ohayo_records', JSON.stringify(records));
    renderRecords();
    showToast('è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
  }

  function renderRecords() {
    const list = document.getElementById('recordsList');
    if (records.length === 0) {
      list.innerHTML = '<div class="records-empty" id="emptyMsg">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</div>';
      return;
    }
    list.innerHTML = records.map(r => `
      <div class="record-item">
        <div class="record-dot"></div>
        <div class="record-info">
          <div class="record-date">${r.date} ${r.startTime} èµ·åºŠ</div>
          <div class="record-time">å¸ƒå›£ã‚’å‡ºã‚‹ã¾ã§</div>
        </div>
        <div class="record-duration">${r.durationStr}</div>
        <button class="btn-del" onclick="deleteRecord(${r.id})">âœ•</button>
      </div>
    `).join('');
  }

  function copyAll() {
    if (records.length === 0) { showToast('ã‚³ãƒ”ãƒ¼ã™ã‚‹è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“'); return; }
    const text = records.map(r =>
      `${r.date} ${r.startTime} èµ·åºŠï½œèµ·ãä¸ŠãŒã‚Šæ™‚é–“: ${r.durationStr}`
    ).join('\n');
    showCopyModal(text);
  }

  function showCopyModal(text) {
    const existing = document.getElementById('copyModal');
    if (existing) existing.remove();

    const modal = document.createElement('div');
    modal.id = 'copyModal';
    modal.style.cssText = `
      position:fixed;inset:0;background:rgba(0,0,0,0.7);
      display:flex;align-items:center;justify-content:center;
      z-index:200;padding:20px;
    `;
    modal.innerHTML = `
      <div style="background:#1a2030;border:1px solid #2a3444;border-radius:16px;padding:24px;width:100%;max-width:400px;">
        <div style="font-family:'Shippori Mincho',serif;font-size:0.85rem;letter-spacing:0.2em;color:#ffd580;margin-bottom:12px;">ğŸ“‹ è¨˜éŒ²ã‚’ã‚³ãƒ”ãƒ¼</div>
        <textarea id="copyTextArea" readonly style="
          width:100%;height:160px;background:#0d1117;border:1px solid #2a3444;
          border-radius:8px;color:#e8e0d4;font-family:'Noto Serif JP',serif;
          font-size:0.8rem;line-height:1.7;padding:12px;resize:none;letter-spacing:0.05em;
        ">${text}</textarea>
        <div style="font-size:0.72rem;color:#8a8a9a;margin-top:8px;letter-spacing:0.1em;">
          ä¸Šã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¨é¸æŠï¼ˆCtrl+A / âŒ˜Aï¼‰ã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„
        </div>
        <button onclick="document.getElementById('copyModal').remove()" style="
          margin-top:14px;width:100%;background:none;border:1px solid #2a3444;
          color:#8a8a9a;padding:8px;border-radius:8px;font-family:'Noto Serif JP',serif;
          font-size:0.78rem;cursor:pointer;letter-spacing:0.1em;
        ">é–‰ã˜ã‚‹</button>
      </div>
    `;
    document.body.appendChild(modal);

    setTimeout(() => {
      const ta = document.getElementById('copyTextArea');
      if (ta) { ta.focus(); ta.select(); }
    }, 50);

    modal.addEventListener('click', e => {
      if (e.target === modal) modal.remove();
    });
  }

  function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 2500);
  }

  renderRecords();

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
</script>
</body>
</html>
